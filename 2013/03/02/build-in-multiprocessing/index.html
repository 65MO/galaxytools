<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Le styles -->
    <link href="http://bgruening.github.io/galaxytools/css/bootstrap.css" rel="stylesheet">
    <link href="http://bgruening.github.io/galaxytools/css/style.css" rel="stylesheet">
    <style>
      body { padding-top: 60px; /* 60px to make the container go all the way
      to the bottom of the topbar */ }
    </style>
    <link href="http://bgruening.github.io/galaxytools/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="http://bgruening.github.io/galaxytools/css/pygments.css">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js">
      </script>
    <![endif]-->
    <!-- Le fav and touch icons -->
    <style>
    </style>

    <link rel="stylesheet" href="http://bgruening.github.io/galaxytools/css/gh-fork-ribbon.css" />
    <!--[if IE]>
        <link rel="stylesheet" href="http://bgruening.github.io/galaxytools/css/gh-fork-ribbon.ie.css" />
    <![endif]-->

  </head>
  <body>
    <div class="github-fork-ribbon-wrapper right-bottom">
        <div class="github-fork-ribbon">
                <a href="https://github.com/bgruening/galaxytools">Fork me on GitHub</a>
        </div>
    </div>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
            <div style="display: table; float: left; width: 50%; height: 100%;">

                <div class="nav-collapse collapse" style="display: table-cell; vertical-align: middle;">
                    <ul class="nav" style="vertical-align:middle;">
                        <!-- active -->
                      <li><a class="brand" href="http://bgruening.github.io/galaxytools/">Galaxytools</a></li>
                      <li><a class="" href="http://bgruening.github.io/galaxytools/about/">About</a></li>
                      <li><a class="" href="http://bgruening.github.io/galaxytools/news/">News</a></li>
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle jetstrap-highlighted" data-toggle="dropdown">Tools<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                          <li class="divider" style="border-bottom: 1px solid #000000"></li>
                          <li class="nav-header">Cheminformatics</li>
                          <li><a class="" href="http://bgruening.github.io/galaxytools/projects/chemicaltoolbox/">ChemicalToolBoX</a></li>
                          <li><a class="" href="http://bgruening.github.io/galaxytools/projects/chemicaltoolbox/fragmenter">Fragmeter</a></li>
                          <li class="divider" style="border-bottom: 1px solid #000000"></li>
                          <li class="nav-header">Genomics</li>
                          <li><a class="" href="http://bgruening.github.io/galaxytools/projects/methtools">Methtools</a></li>
                          <li><a class="" href="http://bgruening.github.io/galaxytools/projects/bismark">Bismark</a></li>
                          <li class="divider" style="border-bottom: 1px solid #000000"></li>
                          <li class="nav-header">et cetera</li>
                          <li><a href="http://bgruening.github.io/galaxytools/projects/dependencies">tool dependencies</a></li>
                        </ul>
                      </li>
                    </ul>
                </div><!--/.nav-collapse -->

            </div>
            <div style="display: table; text-align: right; float: right; width: 50%; height:100%;">
                <div style="display: table-cell; vertical-align: middle;">
                    <a href="https://github.com/bgruening/galaxytools" class="btn btn-primary btn-large">View On GitHub</a>
                    <a href="https://github.com/bgruening/galaxytools/tarball/master" class="btn btn-primary btn-large">TAR</a>
                    <a href="https://github.com/bgruening/galaxytools/zipball/master" class="btn btn-primary btn-large">ZIP</a>
                </div>
            </div>
        </div>
      </div>
    </div>
    
    <div class="container main">



<div class="row-fluid">
  <div class="span8">
    <h1>Divide & Conquer (mutiprocessing)</h1>
    <p class="muted">02 March 2013</p>

    <p>Galaxy has some initial support for build-in multiprocessing.
In the datatype definition you can define merge() and split() functions
to devide &amp; conquer your input datasets. After processing every splitted file all results
will be merged automatically.</p>
<p>I commited today an extended definition of SMILES, InChI and SDF datatypes and
enabled the multiprocessing feature in a few tools, like QED and Converters.
Depending on your galaxy configuration and the available computer cores your calculations
can be X times faster now.</p>
<p>During processing 50.000.000 SMILES I found a small bug in the concatination routine of galaxy.
Using cat to merge 1000 of files seems not to be suitable, because the shell has a commandline limit
defined in ARG_MAX:</p>
<figure class="code"><div class="highlight"><table><tr><td class="code"><pre><code class="console"><span class="line"><span class="gp">$</span> getconf ARG_MAX
</span><span class="line"><span class="gp">$</span> 2097152
</span></code></pre></td></tr></table></div></figure><p>The solution is to use python's shutil module and iterate over all splitted files.</p>
<figure class="code"><figcaption><span>Python file merging:</span> </figcaption><div class="highlight"><table><tr><td class="code"><pre><code class="python"><span class="line"><span class="k">for</span> <span class="n">fsrc</span> <span class="ow">in</span> <span class="n">split_files</span><span class="p">:</span>
</span><span class="line">   <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span> <span class="n">fsrc</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span> <span class="p">),</span> <span class="n">fdst</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure><p>That solution is not slower than cat, pythonic and it works for a unlimited amount of files.
Patch and Pull request is submitted as <a class="reference external" href="https://bitbucket.org/galaxy/galaxy-central/pull-request/141/">#141</a>.</p>


  </div>
  <div class="span4">
    <h3>About Galaxytools</h3>

<p>Donec libero libero, bibendum non condimentum ac, ullamcorper at sapien.\
 Duis feugiat urna vel justo cursus facilisis. Vivamus ligula dui, convalli\
s a varius vitae, facilisis eget magna.</p>

<ul>
  
    <li><a href="/galaxytools//2013/05/22/osra-2.0.0-released/">OSRA 2.0.0 released</a></li>
  
    <li><a href="/galaxytools//2013/05/20/new_orphan_packages/">New Orphan Packages</a></li>
  
    <li><a href="/galaxytools//2013/05/12/one-click-install/">One Click Installation of CTB</a></li>
  
    <li><a href="/galaxytools//2013/04/26/rdkit-2013-03-released/">RDKit 2013-03 released</a></li>
  
    <li><a href="/galaxytools//2013/04/13/natural-product-likeness-predictor-integration/">Natural product likeness scorer</a></li>
  
    <li><a href="/galaxytools//2013/04/12/opsin-integration/">Opsin integration</a></li>
  
    <li><a href="/galaxytools//2013/04/02/fingerprints-fingerprints/">Fingerptints, Fingerprints!</a></li>
  
    <li><a href="/galaxytools//2013/03/25/bug-and-feature-tracker/">CTB: Bug & Feature Tracker</a></li>
  
    <li><a href="/galaxytools//2013/03/02/build-in-multiprocessing/">Divide & Conquer (mutiprocessing)</a></li>
  
</ul>


  </div>
</div>


      <hr>
      <footer>
        <p>Project maintained by <a href="https://github.com/bgruening">Björn Grüning</a></p>
      </footer>

    </div> <!-- /container -->


    <style>
      
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    </script>
    <script src="http://bgruening.github.io/galaxytools/js/bootstrap.js">
    </script>
    <script>

    </script>
  </body>
</html>

