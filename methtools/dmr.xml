<tool id="methtools_dmr" name="Find differentially methylated region (DMR)" version="0.1.1">
    <description></description>
    <requirements>
        <requirement type="package" version="0.1_602edc990c6a36e2930f88f3ae5585430164d643">methtools</requirement>
    </requirements>
    <command>
        dmr.py
        --control $infile_control
        --affected $infile_affected
        --o $outfile

        $fisher

        #if int($min_cov) != -1:
            --mincov $min_cov
        #end if
        #if int($max_cov) != -1:
            --maxcov $max_cov
        #end if
        ###if float(str($quantil)) != 0.0:
        ##    --filter-quantil $quantil
        ###end if


        --min-window-length $min_window_length
        --min-delta-methylation $min_delta_methylation
        --check-last-n $check_last_n
        #if int($allow_failed) != -1:
            --allow-failed $allow_failed
        #end if
        #if int($allow_failed) != -1:
            --max-cpg-distance $max_cpg_distance
        #end if

        ## hyper or hypo output only
        #if str($output_regions) != 'both':
            $output_regions
        #end if

    </command>
    <inputs>
        <param name="infile_control" type="data" format="bed,interval" label="BED file from control sample" help="" />
        <param name="infile_affected" type="data" format="bed,interval" label="BED file from affected sample" help="" />

        <param name="min_cov" type="integer" value="-1" label="Minimal allowed coverage" help="-1 means no filtering at all" />
        <param name="max_cov" type="integer" value="-1" label="Maximal allowed coverage" help="-1 means no filtering at all" />
        <!--<param name="quantil" type="float" value="0.0" label="coverage quantil filter, example for the 99.9 quantil: 0.999" help="0 means no filtering at all">
            <validator type="in_range" message="Value needs to be between 0.0 and 1.0" min="0" max="1"/>
        </param>-->

        <param name="fisher" type="boolean" truevalue="--fisher" falsevalue="" checked="False" label="Calculate pvalue (fisher-exact-test) for each calculated window." help="" />

        <param name="min_window_length" type="integer" value="4" label="minimal window length" />
        <param name="min_delta_methylation" type="integer" value="25" label="minimal delta between the two mehylation states" />
        <param name="check_last_n" type="integer" value="4" label="check last N CpG sites if they fullfill all constraints" />
        <param name="allow_failed" type="integer" value="-1" label="how many sites are allowed to fail in a row" help="-1 means no check at all" />
        <param name="max_cpg_distance" type="integer" value="-1" label="maximal CpG distance" help="-1 means no check at all"/>

        <param name="output_regions" type="select" label="Single- or paired-end reads." help="">
            <option value="both">hyper and hypo mehtylated regions</option>
            <option value="--hyper">hyper methylated region</option>
            <option value="--hypo">hypo methylated regions</option>
        </param>

    </inputs>
    <outputs>
        <data format="interval" name="outfile" label="${tool.name} on ${on_string}: tiling regions" />
    </outputs>
    <tests>
    </tests>

    <help>

**What it does**

Extract differential methylated regions.

  </help>
</tool>
