<tool id="deseq2" name="DESeq2" version="2.0">
  <description>Determines differentially expressed transcripts from read alignments</description>
    <requirements>
        <requirement type="binary">Rscript</requirement>
        <requirement type="R-module">DESeq2</requirement>
        <requirement type="package" version="3.0.1">R_3_0_1</requirement>
        <requirement type="set_environment">DESEQ2_SCRIPT_PATH</requirement>
    </requirements>
    <command interpreter="Rscript">
        deseq2.R
            -o "$deseq_out"

            #if $pdf:
                -p "$plots"
            #end if

            -i "$input_matrix"

        #if $filter_sel.filter_sel_opts == 'all_vs_all':
            -s 'all_vs_all'
        #else:
            -s ## build a string like '1,2 5,6'
            "${filter_sel.control_cols} ${filter_sel.experiement_cols}"

            #set $temp_factor_list = list()
            #set $is_multi_factor_analysis = False
            #for $factor in $filter_sel.factor:
                #set $is_multi_factor_analysis = True
                $temp_factor_list.append( '%s:%s' % ($factor.factor_name.replace(' ','_'), $factor.factor_index) )
            #end for

            #if $is_multi_factor_analysis:
                -f "#echo ' '.join( $temp_factor_list )#"
            #end if
        #end if

    </command>
    <stdio>
        <regex match="Execution halted" 
           source="both" 
           level="fatal" 
           description="Execution halted" />
    </stdio>
    <inputs>
        <param format="tabular" name="input_matrix" type="data" label="Countmatrix" help="You can create a count matrix with the tool ..."/>

         <conditional name="filter_sel">
            <param name="filter_sel_opts" type="select" label="Select properties to filter">
              <option value="all_vs_all">All against all</option>
              <option value="specific">specific</option>
            </param>
            <when value="specific">

                <param name="control_cols" label="Select columns containing treatment." type="data_column" data_ref="input_matrix"
                    numerical="True" multiple="true" use_header_names="true" size="120" display="checkboxes">
                    <validator type="no_options" message="Please select at least one column."/>
                </param>

                <param name="experiement_cols" label="Select columns containing treatment." type="data_column" data_ref="input_matrix"
                    numerical="True" multiple="true" use_header_names="true" size="120" display="checkboxes">
                    <validator type="no_options" message="Please select at least one column."/>
                </param>

                <repeat name="factor" title="Include multi-factor analysis">
                    <param name="factor_name" type="text" value="Factor Name" label="Specify a factor name" help=""/>

                    <param name="factor_index" label="Select columns that are associated with a factor." type="data_column" data_ref="input_matrix"
                        numerical="True" multiple="true" use_header_names="true" size="120" display="checkboxes">
                        <validator type="no_options" message="Please select at least one column."/>
                    </param>
                </repeat>

            </when>
            <when value="all_v_all" />
        </conditional>

        <param name="pdf" type="boolean" truevalue="" falsevalue="" checked="true" label="Visualising the analysis results"
            help="output an additional PDF file" />

    </inputs>

  <outputs>
    <data format="tabular" name="deseq_out" label="DESeq2 result file on ${on_string}"/>
    <data format="pdf" name="plots" label="DESeq2 plots on ${on_string}">
        <filter>pdf == True</filter>
    </data>
  </outputs>

  <help>

.. class:: infomark

**What it does** 

Estimate variance-mean dependence in count data from high-throughput sequencing assays and test for differential expression based on a model using the negative binomial distribution


**Inputs**

`DESeq` requires three input files to run:

TODO:


**Output**


TODO:
`DESeq` generates a tabular file containing the different columns.

====== ========= ============================================
Column NCBI name Description
------ --------- --------------------------------------------
     1 qseqid    Query Seq-id (ID of your sequence)
     2 sseqid    Subject Seq-id (ID of the database hit)
     3 pident    Percentage of identical matches
     4 length    Alignment length
     5 mismatch  Number of mismatches
     6 gapopen   Number of gap openings
     7 qstart    Start of alignment in query
     8 qend      End of alignment in query
     9 sstart    Start of alignment in subject (database hit)
    10 send      End of alignment in subject (database hit)
    11 evalue    Expectation value (E-value)
    12 bitscore  Bit score
====== ========= ============================================



------

**Licenses**


TODO:

If **DESeq** is used to obtain results for scientific publications it
should be cited as [1]_.

**References** 

.. [1] Anders, S and Huber, W (2010): `Differential expression analysis for sequence count data`_. 

.. _Differential expression analysis for sequence count data: http://dx.doi.org/10.1186/gb-2010-11-10-r106


</help>
</tool>
