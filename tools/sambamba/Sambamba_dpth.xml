<tool id="sambamba_depth" name="Depth" version="@WRAPPER_VERSION@">
    <description>Base, region and window modes !</description>
    <macros>
        <import>Sambamba_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <command>
<![CDATA[
        #set $min=0
        #set $input = 'infile1.bam'
        ln -s "$input_file1" $input &&
        ln -s "$input_file1.metadata.bam_index" infile1.bai &&
        @EXECUTABLE
        #if $function.function_select=="dpthbase"
            depth base
             $function.z
             #if $function.L
                -L $function.L
             #end if  
        #else if $function.function_select=="dpthregion" 
            depth region
            -L $function.L
        #else if $function.function_select=="dpthwindow" 
            depth window
            -w $function.w
            --overlap=$function.overlap
        #end if
        #if $F
             -F $F
        #end if 
        #if $c >= $min
            -c $c
        #else
            -c $min
        #end if
        -C $C            
        -q $q
        $combined
        $a   
        $input > $output
]]>
    </command>
    <inputs>
        <expand macro="inputSetup1"/> 
        <conditional name="function"> 
           <param name="function_select" type="select" label="Select Sambamba depth mode">
               <option value="dpthbase">Depth - base mode</option>
               <option value="dpthregion">Depth - region mode</option>
               <option value="dpthwindow">Depth - window mode</option>
           </param>

           <when value="dpthbase">
               <param name="z" type="boolean" truevalue="-z" falsevalue="" checked="false" label="Zero coverage bases will not be skipped"/>
               <param name="L" type="text" optional="true" label="FILENAME | REGION: Supply filename or regions of interest or a single region in form chr:beg-end" help="For example: chr17:40-200"/>
           </when>

           <when value="dpthregion">
               <param name="L" type="text" optional="false" label="FILENAME | REGION: Supply filename or regions of interest or a single region in form chr:beg-end(required)" help="For example: chr17:40-200"/>
           </when>
           
           <when value="dpthwindow">
               <param name="w" type="integer" value="1" optional="false" label="Breadth of the window, in bp (required)"/>
               <param name="overlap" type="integer" value="0" optional="false" label="Overlap of successive windows, in bp"/>
               <param name="T" type="text" optional="false" label="FILENAME | REGION: Supply filename or regions of interest or a single region in form chr:beg-end(required)" help="For example: chr17:40-200"/>
           </when>           
        </conditional>
        <expand macro="depthParameters"/> 
    </inputs>
    <outputs>
        <data name="output" format="text"/>
    </outputs>

    <tests>
        <test>
            <expand macro="inputSetup1"/>
            <param name="input_file1" value="Example.sorted.bam" ftype="bam"/>         
            <param name="function_select" value="dpthbase"/> 
            <param name="L" value="chr17"/>
            <param name="c" value="12"/>    
            <param name="C" value="200"/>     
            <output name="o" file="Depth.txt">
                <assert_contents>
                    <has_text text="chr" />
                </assert_contents>
            </output>         
        </test>
    </tests>
    <help>
<![CDATA[
@REFERENCES@

All BAM files must be coordinate-sorted and indexed.

Sambamba_depth has three modes: base, region, and window where each name means per which unit to print the statistics.
]]>
    </help>
    <expand macro="citations" />
</tool>
